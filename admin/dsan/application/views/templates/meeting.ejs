<!DOCTYPE html>

<html lang="en">

	<!-- begin::Head -->
	<head>
		<meta charset="utf-8" />
		<title><%= vendor %> | <%= title %></title>
		<meta name="description" content="Latest updates and statistic charts">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no">

		<%- include('common/header.ejs') %>

	</head>

	<!-- end::Head -->

	<!-- begin::Body -->
	<body class="m-page--fluid m--skin- m-content--skin-light2 m-header--fixed m-header--fixed-mobile m-aside-left--enabled m-aside-left--skin-dark m-aside-left--fixed m-aside-left--offcanvas m-footer--push m-aside--offcanvas-default">

		<!-- begin:: Page -->
		<div class="m-grid m-grid--hor m-grid--root m-page">

			<%- include('common/topbar.ejs') %>

			<!-- begin::Body -->
			<div class="m-grid__item m-grid__item--fluid m-grid m-grid--ver-desktop m-grid--desktop m-body">

				<%- include('common/leftbar.ejs') %>

				<div class="m-grid__item m-grid__item--fluid m-wrapper">

					<!-- BEGIN: Subheader -->
					<div class="m-subheader ">
						<div class="d-flex align-items-center">
							<div class="mr-auto">
								<h3 class="m-subheader__title m-subheader__title--separator">Meeting</h3>
								<ul class="m-subheader__breadcrumbs m-nav m-nav--inline">
									<li class="m-nav__item m-nav__item--home">
										<a href="<%= base_url %>/dashboard" class="m-nav__link m-nav__link--icon">
											<i class="m-nav__link-icon la la-home"></i>
										</a>
									</li>
									<li class="m-nav__separator">-</li>
									<li class="m-nav__item">
										<a href="" class="m-nav__link">
											<span class="m-nav__link-text">Meeting</span>
										</a>
									</li>
								</ul>
							</div>
						</div>
					</div>

					<!-- END: Subheader -->
					<div class="m-content">

                        <%- include(path) %>
                        
					</div>
				</div>
			</div>

			<!-- end:: Body -->

			<%- include('common/footer_content.ejs') %>

		</div>

		<!-- end:: Page -->

		<%- include('common/footer.ejs') %>
		
		<script type="text/javascript">

			var addMeetingFormControl = {
				init:function() {
					$("#addMeetingForm").validate( {
						rules: {
							meetingName: {
								required: true
							},
							meetingId: {
								required: true
							},
							meetingDate: {
								required: true
							},
							meetingTime: {
								required: true
							},
							meetingDuration: {
								required: true
							},
							meetingParticipant: {
								required: true,
								number: true
							}
						},
						messages: {
							meetingName: {
								required: "Please enter meeting name"
							},
							meetingId: {
								required: "Please enter meeting ID"
							},
							meetingDate: {
								required: "Please select meeting date"
							},
							meetingTime: {
								required: "Please select meeting time"
							},
							meetingDuration: {
								required: "Please enter meeting duration"
							},
							meetingParticipant: {
								required: "Please enter total participant",
								number: "Please enter valid number"
							}
						}
						, invalidHandler:function(e, r) {
							mUtil.scrollTop()
						}
						, submitHandler:function(form) {

							var data = {};
							data.meetingName = $("#meetingName").val();
							data.meetingId = $("#meetingId").val();	
							data.meetingDate = $("#meetingDate").val();
							data.meetingTime = $("#meetingTime").val();
							data.meetingDuration = $("#meetingDuration").val();
							data.meetingParticipant = $("#meetingParticipant").val();
						
							$.ajax({
								type: 'POST',
								data: JSON.stringify(data),
								contentType: 'application/json',
								url: '<%= base_url %>/meeting/add',
								success: function(data) 
								{
									response = JSON.parse(data);
									if(response.response)
									{   
										$('#addMeetingForm').trigger("reset");
										$(".meeting_list").mDatatable("reload");
										toastr.success(response.message);
										setTimeout(function() {
											$('#addMeetingModal').modal('hide');
										}, 3000);
									}
									else
									{      
										toastr.error(response.message);
									}
								},
								error:function(data)
								{
									toastr.error("Something went wrong!");
								}
							});

						}
					}
					)
				}
			};

    
			var t;
			var DatatableRemoteAjaxDemo= {
				init:function() {
					t=$(".meeting_list").mDatatable( {
						data: {
							type:"remote", source: {
								read: {
									url:"<%= base_url %>/meeting/list", map:function(t) {
										var e=t;
										return void 0!==t.data&&(e=t.data), e
									}
								}
							}
							, pageSize:10, serverPaging:!0, serverFiltering:!0, serverSorting:!0
						}
						, layout: {
							scroll: !1, footer: !1
						}
						, sortable:!0, pagination:!0, toolbar: {
							items: {
								pagination: {
									pageSizeSelect: [10, 20, 30, 50, 100]
								}
							}
						}
						, search: {
							input: $("#generalSearch")
						}
						, columns:[ 
				  
							{
								field: "mt_mid", title: "Meeting ID", selector: !1, textAlign: "center", sortable: !1
							},
				  			{
								field:"mt_name", title:"Name", filterable:!1, textAlign: "center", sortable: !1
							},
							{
								field:"Date", title:"Date", sortable:!1, overflow:"visible", template:function(t, e, a) {
									var date = new Date(t.mt_date);
									return date.toISOString().slice(0,10);
								}
							},
				  			{
								field:"mt_time", title:"Time", filterable:!1, textAlign: "center", sortable: !1
							},
				  			{
								field:"mt_duration", title:"Duration", filterable:!1, textAlign: "center", sortable: !1
							},
				  			{
								field:"mt_participant", title:"Participant", filterable:!1, textAlign: "center", sortable: !1
							},
							{
								field:"Status", title:"Status", sortable:!1, overflow:"visible", template:function(t, e, a) {
									
									if(t.mt_status == 'Active')
									{
										var q = new Date();
										var currentDate = q.getFullYear() + "-" + (q.getMonth()+1) + "-" + q.getDate();
										var date   = new Date(currentDate);
										var mydate = new Date(t.mt_date);

										if(date  >mydate)
										{
											return '<a href="javascript:void(0)" class="btn btn-outline-primary m-btn m-btn--icon btn-lg m-btn--icon-only m-btn--pill m-btn--air"><i class="la la-history"></i></a>'
										}
										else
										{
											return '<a href="javascript:void(0)" class="btn btn-outline-primary m-btn m-btn--icon btn-lg m-btn--icon-only m-btn--pill m-btn--air"  onclick="changeMeetingStatus('+ t.mt_id +')"><i class="la la-history"></i></a>'
										}										
									}
									else
									{
										var q = new Date();
										var currentDate = q.getFullYear() + "-" + (q.getMonth()+1) + "-" + q.getDate();
										var date   = new Date(currentDate);
										var mydate = new Date(t.mt_date);
										if(date  >mydate)
										{
											return '<a href="javascript:void(0)" class="btn btn-outline-brand m-btn m-btn--icon btn-lg m-btn--icon-only m-btn--pill m-btn--air" ><i class="la la-power-off"></i></a>'
										}
										else
										{
											return '<a href="javascript:void(0)" class="btn btn-outline-brand m-btn m-btn--icon btn-lg m-btn--icon-only m-btn--pill m-btn--air" onclick="changeMeetingStatus('+ t.mt_id +')"><i class="la la-power-off"></i></a>'
										}
									}
									
								}
							},
							{
								field:"Actions", title:"Actions", sortable:!1, overflow:"visible", template:function(t, e, a){
									var q = new Date();
									var currentDate = q.getFullYear() + "-" + (q.getMonth()+1) + "-" + q.getDate();
									var date   = new Date(currentDate);
									var mydate = new Date(t.mt_date);
									if(date  >mydate)
									{
										return '<a href="javascript:void(0)" class="m-portlet__nav-link btn m-btn m-btn--hover-brand m-btn--icon m-btn--icon-only m-btn--pill" title="Update Meeting"><i class="la la-edit"></i></a>'
									}
									else
									{
										return '<a href="javascript:void(0)" class="m-portlet__nav-link btn m-btn m-btn--hover-brand m-btn--icon m-btn--icon-only m-btn--pill" title="Update Meeting" onclick="editMeeting('+ t.mt_id +')"><i class="la la-edit"></i></a>'
									}
								}
							}
						]
					});
				}
			};

			var BootstrapDatepicker=function() {
				var t;
				t=mUtil.isRTL()? {
					leftArrow: '<i class="la la-angle-right"></i>', rightArrow: '<i class="la la-angle-left"></i>'
				}
				: {
					leftArrow: '<i class="la la-angle-left"></i>', rightArrow: '<i class="la la-angle-right"></i>'
				}
				;
				return {
					init:function() {
						$("#meetingDate, #editMeetingDate").datepicker( {
							rtl: mUtil.isRTL(), todayHighlight: !0, orientation: "bottom left", templates: t, format: 'yyyy-mm-dd'
						}
						)
					}
				}
			}
			();

			var BootstrapTimepicker= {
				init:function() {
					$("#meetingDuration, #editMeetingDuration").timepicker( {
						minuteStep: 1, showSeconds: !0, showMeridian: !1, snapToStep: !0
					}
					),
					$("#meetingTime, #editMeetingTime").timepicker( {
						minuteStep: 1, showSeconds: !0, showMeridian: !0
					}
					)
				}
			};
	  
		 	jQuery(document).ready(function() {
				DatatableRemoteAjaxDemo.init()
				addMeetingFormControl.init()
				updateMeetingFormControl.init()
				BootstrapDatepicker.init()
				BootstrapTimepicker.init()
			});	
			
			function changeMeetingStatus(id)
			{
				var data = {};
				data.type = 'change_status';
				data.id = id;	
			
				$.ajax({
					type: 'POST',
					data: JSON.stringify(data),
					contentType: 'application/json',
					url: '<%= base_url %>/meeting/change-status',
					success: function(data) 
					{
						response = JSON.parse(data);
						if(response.response)
						{   
							$(".meeting_list").mDatatable("reload");
							toastr.success(response.message);
						}
						else
						{      
							toastr.error(response.message);
						}
					},
					error:function(data)
					{
						toastr.error("Something went wrong!");
					}
				});
			}

			function editMeeting(id) {
				var data = {};
				data.type = 'edit-meeting';
				data.id = id;	
			
				$.ajax({
					type: 'POST',
					data: JSON.stringify(data),
					contentType: 'application/json',
					url: '<%= base_url %>/meeting/details',
					success: function(data) 
					{
						response = JSON.parse(data);
						if(response.response)
						{   
							$("#editMeetingName").val(response.data.mt_name);
							$("#editMeetingId").val(response.data.mt_mid);
							var date = new Date(response.data.mt_date);
							var mtdate = date.toISOString().slice(0,10);
							$("#editMeetingDate").val(mtdate);
							$("#editMeetingTime").val(response.data.mt_time);
							$("#editMeetingDuration").val(response.data.mt_duration);
							$("#editMeetingParticipant").val(response.data.mt_participant);
							$("#editMeetingUpdateId").val(response.data.mt_id);
							$('#editMeetingModal').modal('show');
						}
						else
						{      
							toastr.error(response.message);
						}
					},
					error:function(data)
					{
						toastr.error("Something went wrong!");
					}
				});
			}

			var updateMeetingFormControl = {
				init:function() {
					$("#editMeetingForm").validate( {
						rules: {
							editMeetingName: {
								required: true
							},
							editMeetingId: {
								required: true
							},
							editMeetingDate: {
								required: true
							},
							editMeetingTime: {
								required: true
							},
							editMeetingDuration: {
								required: true
							},
							editMeetingParticipant: {
								required: true,
								number: true
							}
						},
						messages: {
							editMeetingName: {
								required: "Please enter meeting name"
							},
							editMeetingId: {
								required: "Please enter meeting ID"
							},
							editMeetingDate: {
								required: "Please select meeting date"
							},
							editMeetingTime: {
								required: "Please select meeting time"
							},
							editMeetingDuration: {
								required: "Please enter meeting duration"
							},
							editMeetingParticipant: {
								required: "Please enter total participant",
								number: "Please enter valid number"
							}
						}
						, invalidHandler:function(e, r) {
							mUtil.scrollTop()
						}
						, submitHandler:function(form) {

							var data = {};
							data.editMeetingName = $("#editMeetingName").val();
							data.editMeetingId = $("#editMeetingId").val();	
							data.editMeetingDate = $("#editMeetingDate").val();
							data.editMeetingTime = $("#editMeetingTime").val();
							data.editMeetingDuration = $("#editMeetingDuration").val();
							data.editMeetingParticipant = $("#editMeetingParticipant").val();
							data.editMeetingUpdateId = $("#editMeetingUpdateId").val();
						
							$.ajax({
								type: 'POST',
								data: JSON.stringify(data),
								contentType: 'application/json',
								url: '<%= base_url %>/meeting/update',
								success: function(data) 
								{
									response = JSON.parse(data);
									if(response.response)
									{   
										$('#editMeetingForm').trigger("reset");
										$(".meeting_list").mDatatable("reload");
										toastr.success(response.message);
										setTimeout(function() {
											$('#editMeetingModal').modal('hide');
										}, 3000);
									}
									else
									{      
										toastr.error(response.message);
									}
								},
								error:function(data)
								{
									toastr.error("Something went wrong!");
								}
							});

						}
					}
					)
				}
			};
		</script>

	</body>

	<!-- end::Body -->
</html>